> **π“… μ—…λ΅λ“ λ‚ μ§**  
> 2025-09-02
> 
> **π—‚ λ¶„λ¥**  
> network
>
> **π”— λ…Έμ… λ§ν¬**  
> [λ…Έμ…μ—μ„ λ³΄κΈ°](https://important-marquess-d42.notion.site/TLS-SSL-handshake-25ea654e658a80f8adb1e9b848a8b97b?source=copy_link)
>

# TLS/SSL handshake

- **SSL**μ μ©λ„λ” μ›Ήμ„ ν†µν• ν†µμ‹ μ„ μ•μ „ν•κ² μ μ§€ν•λ” κ²ƒ.
- **TLS**λ” **SSL**μ μ§μ ‘μ μΈ ν›„μ†μ΄λ©° μ΄μ  λ¨λ“  λ²„μ „μ **SSL**μ΄ λ” μ΄μƒ μ‚¬μ©λμ§€ μ•λ”λ‹¤.
- ν•μ§€λ§ **TLS** μ—°κ²°μ„ μ„¤λ…ν•λ” λ°Β **SSL**μ΄λΌλ” μ©μ–΄κ°€ λ§μ΄ μ‚¬μ©λ©λ‹λ‹¤. λ€λ¶€λ¶„μ κ²½μ°Β **SSL**Β λ°Β **SSL/TLS**λΌλ” μ©μ–΄ λ¨λ‘ **TLS** ν”„λ΅ν† μ½κ³Ό **TLS** μΈμ¦μ„λ¥Ό λ‚νƒ€λ‚Έλ‹¤.
- HTTPS , TCP, UDPμ™€ κ°™μ€ μΌλ°μ μΈ μΈν„°λ„· ν†µμ‹ μ—Β **μ•μ „ν• κ³„μΈµ(layer)**μ„Β μ¶”κ°€ν•λ” λ°©μ‹μ…λ‹λ‹¤.
- SSL μΈμ¦μ„ κ³Όμ •μ—λ” λ€μΉ­ν‚¤ λ°©μ‹κ³Ό κ³µκ°ν‚¤ λ°©μ‹ λ‘ κ° λ¨λ‘ μ‚¬μ©λμ—λ‹¤. λ¨λ“  μ›Ή μ½ν…μΈ μ μ „λ‹¬μ„ κ³µκ°ν‚¤ λ°©μ‹μΌλ΅ ν•λ‹¤λ©΄ μ›Ή μ„λ²„μ™€ λΈλΌμ°μ €μ— λ§μ€ λ¶€λ‹΄μ΄ λκΈ° λ•λ¬Έμ— SSL Handshake λ‹¨κ³„κΉμ§€λ” **κ³µκ°ν‚¤ λ°©μ‹**, κ·Έ μ΄ν›„μ HTTPS ν†µμ‹ μ€ **λ€μΉ­ν‚¤ λ°©μ‹**μ„ μ‚¬μ©ν•λ‹¤.

## λ€μΉ­ν‚¤ / λΉ„λ€ν‚Ήν‚¤λ€?

- λ€μΉ­ν‚¤ μ•”νΈν™” = ν•λ‚μ ν‚¤ μ‚¬μ©
- λΉ„λ€μΉ­ν‚¤ μ•”νΈν™” = κ³µκ°ν‚¤, κ°μΈν‚¤ λ‘κ° μ‚¬μ©

### λ€μΉ­ν‚¤

- ν•λ‚μ ν‚¤ λ΅ ν‰λ¬Έμ„ μ•”νΈν™”ν•κ³  λ‹¤μ‹ μ•”νΈλ¬Έμ„ ν‰λ¬ΈμΌλ΅ λ³µνΈν™”ν•  λ• μ‚¬μ©ν•λ” λ°©μ‹μ΄λ‹¤.
- λ€λ¬Έμ„ μ κ·Έλ” μλ¬Όμ‡ λ¥Ό λ– μ¬λ ¤λ³΄λ©΄, μλ¬Όμ‡ λ¥Ό μ κ·Ό μ—΄μ‡ λ§μ΄ κ·Έ μΆλ¬Όμ‡ λ¥Ό λ‹¤μ‹ μ—΄ μ μλ‹¤. μ¦‰ ν•λ‚μ μ—΄μ‡ λ¥Ό μ‚¬μ©ν•λ”λ°, λ§μ•½ μƒμ–΄λ²„λ Έλ‹¤? λ³΄μ•μ·¨μ•½ γ… 

### λΉ„λ€μΉ­ν‚¤ (κ³µκ°ν‚¤ μ•”νΈν™”)

- λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”λ” (κ³µκ°ν‚¤)- (κ°μΈν‚¤) λ‘κ°λ¥Ό κ°€μ§„λ‹¤.
- Aμ™€ Bκ°€ μλ‹¤κ³  κ°€μ •ν–μ„λ•,
    - Aλ” (Aκ³µκ°ν‚¤), (Aκ°μΈν‚¤) κ°€ μμ„ κ²ƒμ΄κ³ , Aκ³µκ°ν‚¤λ΅ μ•”νΈν™” ν•κ²ƒμ€ AλΉ„λ°€ν‚¤λ§ λ³µνΈν™”κ°€ κ°€λ¥
    - Bλ” (Bκ³µκ°ν‚¤), (Bκ°μΈν‚¤) κ°€ μμ„ κ²ƒμ΄λ‹¤, Bκ³µκ°ν‚¤λ΅ μ•”νΈν™” ν•κ²ƒμ€ BλΉ„λ°€ν‚¤λ§ λ³µνΈν™”κ°€ κ°€λ¥
    - ex) Aκ°€ Bμ—κ² λ°μ΄ν„°λ¥Ό λ³΄λ‚΄κ³  μ‹¶λ‹¤λΌλ” μμ λ¥Ό λ“¤μ–΄λ³΄μ
        - Aλ” (Bκ³µκ°ν‚¤) λ΅ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•΄μ„ λ³΄λ‚Έλ‹¤
        - κ·ΈλΌ Bλ” μ΄κ±Έ (Bκ°μΈν‚¤)λ΅ λ³µνΈν™” ν•΄μ„ λ°μ΄ν„°λ¥Ό μ½μ–΄λ“¤μΈλ‹¤.

## 4. TLS ν•Έλ“μ…°μ΄ν¬

- HTTP/1.1Β·HTTP/2: `TCP 3-way handshake` β†’ `**TLS ν•Έλ“μ…°μ΄ν¬**` β†’ κ·Έλ‹¤μμ—μ•Ό HTTP μ”μ²­ μ „μ†΅
- `TCP 3-way handshake`  λ” μ—°κ²° μ„±λ¦½ν•κ³  λ°μ΄ν„° μ „μ†΅μ„ κ°€λ¥ν•κ² ν•κ³ 
- κ·Έμ„μ— **`TLS** handshake`  λ¥Ό μ§„ν–‰ν•΄μ„ λ€μΉ­ν‚¤ κΈ°λ° μ•”νΈν™”λ λ°μ΄ν„° μ „μ†΅ν•λ‹¤.
- μ¦‰, TLSλ” HTTP μμ²΄λ¥Ό λ°”κΎΈλ” κ² μ•„λ‹λΌ, HTTP μ„μ— λ³΄μ• κ³„μΈµμ„ μ–Ήμ–΄μ„ **HTTP Secure** β‡’ **HTTPS** λ§λ“¬


<img width="585" height="570" alt="image (26)" src="https://github.com/user-attachments/assets/7bb03c88-6b7c-41d8-a499-cef7c4b048d8" />

1. **ClientHello** 
    
    μ•„λ μ μ• λ©λ΅μ„ λ‹΄μ•„μ„ μ„λ²„λ΅ λ³΄λƒ„
    
    - **SNI** : (μ ‘μ†ν•λ ¤λ” νΈμ¤νΈλ… (www.example.com))
    - **ALPN (**μ–΄λ–¤ HTTP κ³„μΈµ ν”„λ΅ν† μ½ μ“Έμ§€ http/1.1 )
    - **Cipher Suites** (λΈλΌμ°μ €κ°€ μ§€μ›ν•λ” μ•”νΈν™” λ°©μ‹ λ¨μ)
    - **Random** (λ‚μ)
    - **key_share** (ν΄λΌμ΄μ–ΈνΈμ κ³µκ°ν‚¤)
    
2. **ServerHello**
 ClientHello μ μ μ•μ„ μ„λ²„κ°€ μ„ νƒν•΄μ„ μ‘λ‹µν•©λ‹λ‹¤.
    - **Cipher Suite** (ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ ν›„λ³΄ μ¤‘ ν•λ‚λ¥Ό κ³ λ¦„)
    - **Random** (λ‚μ)
    - **key_share** (μ„λ²„μ κ³µκ°ν‚¤)
    - **ALPN** (ν”„λ΅ν† μ½ μ„ νƒ)
    - μ„λ²„ μΈμ¦μ„(SSLμΈμ¦μ„) μ „μ†΅
        - μ„λ²„ κ³µκ°ν‚¤ + λ„λ©”μΈ + CA(μΈμ¦κΈ°κ΄€) μ„λ… ν¬ν•¨
        - ν΄λΌμ΄μ–ΈνΈλ” CA κ³µκ°ν‚¤λ΅ μ„λ…μ„ κ²€μ¦ β†’ μ„λ²„ μ§„μ„ ν™•μΈ
    
3. **Finished β†” Finished**
    
    κ°™μ€ ν‚¤λ¥Ό κ°–κ³  μκ³ , λ€ν™” λ‚΄μ©μ΄ λ³€μ΅°λμ§€ μ•μ•μμ„ μ„λ΅ μ¦λ…ν•λ” λ§μ§€λ§‰ λ‹¨κ³„
    
    - μ„λ΅ μ£Όκ³  λ°›μ€ λ©”μ„Έμ§€λ¥Ό μ‚¬μ©ν•΄μ„  κ²€μ¦κ°’(`verify_data`)μ„ λ§λ“¤κ³  μ„λ΅ μ „μ†΅
    - κ°™μ€ κ²€μ¦κ°’μ΄ λ§λ“¤μ–΄μ§€κ² μ§€
    - κ·Έλ¦¬κ³  μ„λ΅ κ°€μ§€κ³  μλ”κ±°λ‘ λ°›μ€κ±°λ‘ λΉ„κµ
        
        β†’ λ€ν™” λ‚΄μ©μ΄ λ³€μ΅°λμ§€ μ•μ•μμ„ ν™•μΈ
        
    
4. λ€μΉ­ν‚¤λ¥Ό λ§λ“λ” κ³Όμ •
    - ECDH(νƒ€μ›κ³΅μ„  λ””ν”Ό-ν—¬λ§) κ°™μ€ μν•™μ  κµ¬μ΅° λ•λ¬Έμ— κ°™μ€ κ³µμ  λΉ„λ°€μ„ λ§λ“¤ μ μμ
    - ν΄λΌμ΄μ–ΈνΈ(C): privC * pubS
    - μ„λ²„(S): privS * pubC
        - κ³µμ λΉ„λ°€μ— ν΄λΌμ΄μ–ΈνΈ λ‚μ+ μ„λ²„ λ‚μ λ„£μ–΄ μµμΆ…μ μΈ **λ€μΉ­ν‚¤(Session Key)**λ¥Ό λ§λ“¤μ–΄λ‚Έλ‹¤.
        - λ€μΉ­ν‚¤κ°€ λ§λ“¤μ–΄μ§„ μκ°„λ¶€ν„° , TLSλ” κ·Έ ν‚¤λ΅ λ¨λ“  HTTP μ”μ²­κ³Ό μ‘λ‹µμ„ μ•”νΈν™”/λ³µνΈν™”ν•λ©΄μ„ μ•μ „ν•κ² ν†µμ‹ μ„ μ΄μ–΄κ°„λ‹¤.
